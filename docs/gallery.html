<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Unjournal - Visual Diagrams</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --accent: #3b82f6;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg-primary);
      min-height: 100vh;
      color: var(--text-primary);
    }

    .header {
      text-align: center;
      padding: 2rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .header h1 {
      font-size: 1.8rem;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .page-nav {
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 0.75rem;
      background: rgba(0,0,0,0.4);
      flex-wrap: wrap;
    }

    .page-nav a {
      color: var(--accent);
      text-decoration: none;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      font-size: 0.85rem;
      transition: all 0.2s;
    }

    .page-nav a:hover {
      background: rgba(59,130,246,0.2);
    }

    .page-nav a.current {
      background: var(--accent);
      color: white;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
      background: rgba(0,0,0,0.3);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .control-group label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    select {
      background: var(--bg-secondary);
      border: 1px solid rgba(255,255,255,0.2);
      color: var(--text-primary);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.9rem;
    }

    select:hover {
      border-color: var(--accent);
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2rem;
    }

    .diagram-section {
      margin-bottom: 3rem;
    }

    .diagram-title {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .diagram-title::before {
      content: '';
      width: 4px;
      height: 1.2rem;
      background: var(--accent);
      border-radius: 2px;
    }

    .diagram-description {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .diagram-card {
      border-radius: 16px;
      padding: 2rem;
      overflow: auto;
      transition: background 0.3s ease;
    }

    /* Theme: Modern Light */
    .theme-modern-light .diagram-card {
      background: #ffffff;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }

    /* Theme: Modern Dark */
    .theme-modern-dark .diagram-card {
      background: #1e293b;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* Theme: Warm */
    .theme-warm .diagram-card {
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
      box-shadow: 0 20px 40px rgba(217,119,6,0.15);
    }

    /* Theme: Cool */
    .theme-cool .diagram-card {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      box-shadow: 0 20px 40px rgba(59,130,246,0.15);
    }

    /* Theme: Nature */
    .theme-nature .diagram-card {
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      box-shadow: 0 20px 40px rgba(34,197,94,0.15);
    }

    .legend {
      display: flex;
      gap: 1.5rem;
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      flex-wrap: wrap;
      justify-content: center;
      font-size: 0.85rem;
    }

    .theme-modern-light .legend,
    .theme-warm .legend,
    .theme-cool .legend,
    .theme-nature .legend {
      background: rgba(0,0,0,0.05);
      color: #475569;
    }

    .theme-modern-dark .legend {
      background: rgba(255,255,255,0.05);
      color: #94a3b8;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 2px solid rgba(0,0,0,0.1);
    }

    .mermaid {
      display: flex;
      justify-content: center;
    }

    /* Shape modifier for rectangle (sharp corners) */
    body.shape-rectangle .mermaid .node rect,
    body.shape-rectangle .mermaid .node polygon {
      rx: 0 !important;
      ry: 0 !important;
    }

    /* Animation helper styles */
    .mermaid .node {
      transform-origin: center center;
    }

    .footer {
      text-align: center;
      padding: 2rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .footer a {
      color: var(--accent);
      text-decoration: none;
    }
  </style>
</head>
<body class="theme-modern-light">

  <header class="header">
    <h1>THE UNJOURNAL</h1>
    <p style="color: var(--text-secondary); margin-top: 0.5rem;">Visual Process Diagrams</p>
  </header>

  <nav class="page-nav">
    <a href="gallery.html" class="current">Themed Gallery</a>
    <a href="index.html">Download Images</a>
    <a href="https://globalimpact.gitbook.io/the-unjournal-project-and-communication-space/">Full Documentation</a>
    <a href="https://unjournal.org">Main Website</a>
  </nav>

  <div class="controls">
    <div class="control-group">
      <label>Theme:</label>
      <select id="themeSelect" onchange="changeTheme(this.value)">
        <option value="modern-light">Modern Light</option>
        <option value="modern-dark">Modern Dark</option>
        <option value="warm">Warm Amber</option>
        <option value="cool">Cool Blue</option>
        <option value="nature">Nature Green</option>
      </select>
    </div>
    <div class="control-group">
      <label>Font Size:</label>
      <select id="fontSizeSelect" onchange="changeFontSize(this.value)">
        <option value="12">Small (12px)</option>
        <option value="14" selected>Medium (14px)</option>
        <option value="16">Large (16px)</option>
        <option value="18">X-Large (18px)</option>
        <option value="20">XX-Large (20px)</option>
      </select>
    </div>
    <div class="control-group">
      <label>Node Shape:</label>
      <select id="shapeSelect" onchange="changeShape(this.value)">
        <option value="rounded" selected>Rounded Rectangle</option>
        <option value="rectangle">Rectangle</option>
        <option value="stadium">Stadium/Pill</option>
        <option value="hexagon">Hexagon</option>
        <option value="parallelogram">Parallelogram</option>
      </select>
    </div>
    <div class="control-group">
      <label>Line Style:</label>
      <select id="curveSelect" onchange="changeCurve(this.value)">
        <option value="basis" selected>Smooth (Basis)</option>
        <option value="linear">Straight (Linear)</option>
        <option value="stepBefore">Step</option>
        <option value="cardinal">Cardinal</option>
      </select>
    </div>
    <div class="control-group">
      <label>Animation:</label>
      <select id="animationSelect" onchange="changeAnimation(this.value)">
        <option value="none">None</option>
        <option value="fade">Fade In</option>
        <option value="slide">Slide In</option>
        <option value="sequential">Sequential Reveal</option>
      </select>
    </div>
    <button onclick="reRenderDiagrams()" style="background: var(--accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-family: inherit;">Apply Changes</button>
  </div>

  <main class="container">

    <!-- Theory of Change - FULL VERSION -->
    <section class="diagram-section">
      <h2 class="diagram-title">Theory of Change (Full)</h2>
      <p class="diagram-description">
        How The Unjournal creates positive global outcomes. <strong>Yellow</strong> = direct path,
        <strong>Green</strong> = multi-step outcomes, <strong>Blue</strong> = academic integration,
        <strong>Pink</strong> = systemic change.
      </p>
      <div class="diagram-card">
        <div class="mermaid">
flowchart TD
    classDef direct fill:#fef3c7,stroke:#d97706,stroke-width:2px,color:#92400e
    classDef multi fill:#dcfce7,stroke:#16a34a,stroke-width:2px,color:#166534
    classDef integrate fill:#dbeafe,stroke:#2563eb,stroke-width:2px,color:#1e40af
    classDef systemic fill:#fce7f3,stroke:#db2777,stroke-width:2px,color:#9d174d

    START["UJ: Tools, Incentives, Platforms"]:::multi

    START -->|enables| EVAL["More Efficient Research Feedback"]:::multi
    START -->|focuses on| FOCUS["Impactful Research"]:::direct
    START -->|pays for| PAY["Academics Evaluate Impact Work"]:::integrate
    START -->|builds| PREDICT["Reliable Quality Predictors"]:::systemic

    FOCUS --> MORE_EVAL["More Evaluation of High-Impact Research"]:::direct
    EVAL --> MORE_EVAL

    MORE_EVAL --> RIGOR["Improved Rigor of Impact Research"]:::direct
    MORE_EVAL --> OPEN["Open Science Practices"]:::direct

    RIGOR --> IMPROVED["Impactful Research Improved"]:::multi
    OPEN --> REPLICABLE["More Replicable and Reliable"]:::direct
    REPLICABLE --> IMPROVED

    PAY --> AWARE["Academic Awareness of Impact Research"]:::integrate
    RIGOR -->|stronger work| AWARE
    AWARE --> ACAD_FOCUS["Academic Focus on Global Priorities"]:::integrate
    PAY --> IMPROVED
    ACAD_FOCUS --> IMPROVED

    EVAL --> ATTRACT["UJ Attractive to Researchers"]:::systemic
    PREDICT --> GATEKEEP["Attractive to Gatekeepers"]:::systemic
    GATEKEEP --> ATTRACT
    ATTRACT --> REPLACE["UJ-Style Replaces Traditional Journals"]:::systemic
    PREDICT --> REPLACE

    REPLACE --> EFFICIENT["Research Evaluation More Efficient"]:::systemic
    EFFICIENT --> USEFUL["Academic Research More Useful"]:::systemic
    USEFUL -->|some is impactful| IMPROVED

    REPLACE --> ACCESS["Open Access"]:::systemic
    ACCESS --> INFORMED["Decision Makers Better Informed"]:::direct

    IMPROVED --> INFORMED
    START -->|incentivizes| FORMATS["Readable, Transparent Formats"]:::systemic
    FORMATS --> INFORMED
    FORMATS --> USEFUL

    INFORMED --> POLICY["Better Policy Choices"]:::multi
    POLICY --> OUTCOMES["Survival and Flourishing"]:::multi
        </div>
        <div class="legend">
          <div class="legend-item"><span class="legend-color" style="background:#fef3c7;border-color:#d97706"></span> Direct path</div>
          <div class="legend-item"><span class="legend-color" style="background:#dcfce7;border-color:#16a34a"></span> Multi-step outcomes</div>
          <div class="legend-item"><span class="legend-color" style="background:#dbeafe;border-color:#2563eb"></span> Academic integration</div>
          <div class="legend-item"><span class="legend-color" style="background:#fce7f3;border-color:#db2777"></span> Systemic change</div>
        </div>
      </div>
    </section>

    <!-- Theory of Change - SIMPLIFIED -->
    <section class="diagram-section">
      <h2 class="diagram-title">Theory of Change (Simplified)</h2>
      <p class="diagram-description">The core path from better evaluation to better outcomes.</p>
      <div class="diagram-card">
        <div class="mermaid">
flowchart TD
    classDef direct fill:#fef3c7,stroke:#d97706,stroke-width:2px
    classDef multi fill:#dcfce7,stroke:#16a34a,stroke-width:2px

    A["Better Research Evaluation"]:::multi
    B["Focus on Impactful Research"]:::direct
    C["Paid Expert Evaluators"]:::multi

    A --> D["Higher Quality Research"]:::direct
    B --> D
    B --> E["Open Science Practices"]:::direct
    C --> F["Academic Interest in Impact"]:::multi

    D --> G["Decision Makers Better Informed"]:::direct
    E --> G
    F --> G

    G --> H["Better Policy Choices"]:::multi
    H --> I["Positive Global Outcomes"]:::multi
        </div>
      </div>
    </section>

    <!-- Evaluation Workflow -->
    <section class="diagram-section">
      <h2 class="diagram-title">Evaluation Workflow</h2>
      <p class="diagram-description">From research submission to published evaluation. Typical timeline: 7-10 weeks.</p>
      <div class="diagram-card">
        <div class="mermaid">
flowchart TD
    classDef start fill:#e0f2fe,stroke:#0284c7,stroke-width:2px
    classDef process fill:#fef3c7,stroke:#d97706,stroke-width:2px
    classDef eval fill:#dbeafe,stroke:#2563eb,stroke-width:2px
    classDef author fill:#fce7f3,stroke:#db2777,stroke-width:2px
    classDef end_good fill:#dcfce7,stroke:#16a34a,stroke-width:3px
    classDef end_bad fill:#fee2e2,stroke:#dc2626,stroke-width:2px

    SUBMIT["Research Submitted or Identified"]:::start
    SUBMIT --> PRIORITY["UJ Team Prioritizes"]:::process
    PRIORITY -->|Low priority| DEPRI["Deprioritized"]:::end_bad
    PRIORITY -->|High priority| CONTACT["Contact Authors for Permission"]:::process
    CONTACT -->|Author declines| DEPRI
    CONTACT -->|Author agrees| MANAGER["Evaluation Manager Assigned"]:::eval
    MANAGER --> RECRUIT["Evaluators Recruited: 2-3 accept"]:::eval
    RECRUIT -->|5+ weeks| REPORTS["Evaluators Complete Reports and Ratings"]:::eval
    REPORTS -->|2 weeks| RESPONSE["Authors Write Response"]:::author
    RESPONSE --> SUMMARY["Manager Writes Summary"]:::eval
    REPORTS --> SUMMARY
    SUMMARY --> PUBLISH["Published on PubPub with DOIs"]:::end_good
    RESPONSE --> PUBLISH
    REPORTS --> PUBLISH
    PUBLISH --> PROMOTE["Promoted and Tracked"]:::process
        </div>
      </div>
    </section>

    <!-- Traditional Journal Comparison -->
    <section class="diagram-section">
      <h2 class="diagram-title">Traditional Journal Process (For Comparison)</h2>
      <p class="diagram-description">The slow, opaque process that The Unjournal improves upon. Average: 24+ months in economics.</p>
      <div class="diagram-card">
        <div class="mermaid">
flowchart TD
    classDef bad fill:#fee2e2,stroke:#dc2626,stroke-width:2px
    classDef neutral fill:#f3f4f6,stroke:#6b7280,stroke-width:1px
    classDef good fill:#dcfce7,stroke:#16a34a,stroke-width:2px

    SUBMIT["Submit to Journal"]:::neutral
    SUBMIT -->|1-3 weeks| SCREEN{"Desk Review"}:::neutral
    SCREEN --> DESK["Desk Rejected"]:::bad
    SCREEN --> PASS["Passes to Reviewers"]:::neutral
    PASS -->|1-4 weeks| FIND["Find Reviewers: 2-3 accept"]:::neutral
    FIND -->|1-6 months| REVIEWS["Reviewers Return Reports"]:::neutral
    REVIEWS -->|kept secret| DECISION{"Editor Decision"}:::neutral
    DECISION --> ACCEPT["Accepted"]:::good
    DECISION --> REJECT["Rejected"]:::bad
    DECISION --> RR["Revise and Resubmit"]:::neutral
    RR -->|4-12 weeks| REVISE["Authors Revise"]:::neutral
    REVISE --> FIND

    ACCEPT --> DATA["Data Editor Review"]:::neutral
    DATA -->|2-8 weeks| PUBLISHED["Published"]:::good

    DESK --> RETRY["Try Another Journal"]:::bad
    REJECT --> RETRY
    RETRY --> SUBMIT
        </div>
      </div>
    </section>

    <!-- Prioritization -->
    <section class="diagram-section">
      <h2 class="diagram-title">Research Prioritization Framework</h2>
      <p class="diagram-description">How we decide which research to evaluate based on relevance, prestige, influence, and methodology.</p>
      <div class="diagram-card">
        <div class="mermaid">
flowchart TD
    classDef start fill:#e0f2fe,stroke:#0284c7,stroke-width:2px
    classDef question fill:#fef3c7,stroke:#d97706,stroke-width:2px
    classDef high fill:#dcfce7,stroke:#16a34a,stroke-width:3px
    classDef medium fill:#fde68a,stroke:#d97706,stroke-width:2px
    classDef low fill:#fee2e2,stroke:#dc2626,stroke-width:2px

    START["Research Suggested"]:::start
    START --> Q1{"Globally Decision-Relevant?"}:::question

    Q1 -->|Yes| Q2{"Prestigious or Already Influential?"}:::question
    Q1 -->|Not directly| Q3{"Supports Impactful Work?"}:::question

    Q2 -->|Prestigious and Relevant| HIGH["HIGH PRIORITY: Definitely Evaluate"]:::high
    Q2 -->|Influential but not prestigious| HIGH2["HIGH PRIORITY: Policy Stream"]:::high
    Q2 -->|Neither yet| Q4{"Strong Methodology?"}:::question

    Q3 -->|Yes: methods, tools| MEDIUM["MEDIUM: Consider If Capacity"]:::medium
    Q3 -->|No| LOW["LOW: Not In Scope"]:::low

    Q4 -->|Rigorous and clear| MEDIUM2["MEDIUM-HIGH: Promising Neglected Work"]:::medium
    Q4 -->|Weak or unclear| LOW
        </div>
      </div>
    </section>

  </main>

  <footer class="footer">
    <p>The Unjournal | <a href="https://unjournal.org">unjournal.org</a> | <a href="https://unjournal.pubpub.org/">Published Evaluations</a> | <a href="https://unjournal.shinyapps.io/uj-dashboard/">Dashboard</a></p>
  </footer>

  <script>
    // Current settings
    let currentSettings = {
      fontSize: 14,
      shape: 'rounded',
      curve: 'basis',
      animation: 'none'
    };

    // Initialize mermaid
    function initMermaid() {
      mermaid.initialize({
        startOnLoad: false,
        theme: 'base',
        themeVariables: {
          fontSize: currentSettings.fontSize + 'px',
          fontFamily: 'Inter, system-ui, sans-serif',
          lineColor: '#64748b',
          primaryTextColor: '#1e293b',
          clusterBkg: 'transparent',
          clusterBorder: 'transparent'
        },
        flowchart: {
          curve: currentSettings.curve,
          padding: 15,
          nodeSpacing: 50,
          rankSpacing: 60,
          htmlLabels: true,
          useMaxWidth: true
        }
      });
    }

    // Shape transformers - convert node syntax
    const shapeTransforms = {
      'rounded': (id, text) => `${id}["${text}"]`,
      'rectangle': (id, text) => `${id}["${text}"]`,
      'stadium': (id, text) => `${id}(["${text}"])`,
      'hexagon': (id, text) => `${id}{{"${text}"}}`,
      'parallelogram': (id, text) => `${id}[/"${text}"/]`
    };

    // Diagram definitions (node ID -> label text)
    const diagramData = {
      'toc-full': {
        title: 'Theory of Change (Full)',
        nodes: {
          'START': 'UJ: Tools, Incentives, Platforms',
          'EVAL': 'More Efficient Research Feedback',
          'FOCUS': 'Impactful Research',
          'PAY': 'Academics Evaluate Impact Work',
          'PREDICT': 'Reliable Quality Predictors',
          'MORE_EVAL': 'More Evaluation of High-Impact Research',
          'RIGOR': 'Improved Rigor of Impact Research',
          'OPEN': 'Open Science Practices',
          'IMPROVED': 'Impactful Research Improved',
          'REPLICABLE': 'More Replicable and Reliable',
          'AWARE': 'Academic Awareness of Impact Research',
          'ACAD_FOCUS': 'Academic Focus on Global Priorities',
          'ATTRACT': 'UJ Attractive to Researchers',
          'GATEKEEP': 'Attractive to Gatekeepers',
          'REPLACE': 'UJ-Style Replaces Traditional Journals',
          'EFFICIENT': 'Research Evaluation More Efficient',
          'USEFUL': 'Academic Research More Useful',
          'ACCESS': 'Open Access',
          'INFORMED': 'Decision Makers Better Informed',
          'FORMATS': 'Readable, Transparent Formats',
          'POLICY': 'Better Policy Choices',
          'OUTCOMES': 'Survival and Flourishing'
        },
        classes: {
          'direct': ['FOCUS', 'MORE_EVAL', 'RIGOR', 'OPEN', 'REPLICABLE', 'INFORMED'],
          'multi': ['START', 'EVAL', 'IMPROVED', 'POLICY', 'OUTCOMES'],
          'integrate': ['PAY', 'AWARE', 'ACAD_FOCUS'],
          'systemic': ['PREDICT', 'ATTRACT', 'GATEKEEP', 'REPLACE', 'EFFICIENT', 'USEFUL', 'ACCESS', 'FORMATS']
        },
        edges: [
          ['START', 'EVAL', 'enables'],
          ['START', 'FOCUS', 'focuses on'],
          ['START', 'PAY', 'pays for'],
          ['START', 'PREDICT', 'builds'],
          ['FOCUS', 'MORE_EVAL', ''],
          ['EVAL', 'MORE_EVAL', ''],
          ['MORE_EVAL', 'RIGOR', ''],
          ['MORE_EVAL', 'OPEN', ''],
          ['RIGOR', 'IMPROVED', ''],
          ['OPEN', 'REPLICABLE', ''],
          ['REPLICABLE', 'IMPROVED', ''],
          ['PAY', 'AWARE', ''],
          ['RIGOR', 'AWARE', 'stronger work'],
          ['AWARE', 'ACAD_FOCUS', ''],
          ['PAY', 'IMPROVED', ''],
          ['ACAD_FOCUS', 'IMPROVED', ''],
          ['EVAL', 'ATTRACT', ''],
          ['PREDICT', 'GATEKEEP', ''],
          ['GATEKEEP', 'ATTRACT', ''],
          ['ATTRACT', 'REPLACE', ''],
          ['PREDICT', 'REPLACE', ''],
          ['REPLACE', 'EFFICIENT', ''],
          ['EFFICIENT', 'USEFUL', ''],
          ['USEFUL', 'IMPROVED', 'some is impactful'],
          ['REPLACE', 'ACCESS', ''],
          ['ACCESS', 'INFORMED', ''],
          ['IMPROVED', 'INFORMED', ''],
          ['START', 'FORMATS', 'incentivizes'],
          ['FORMATS', 'INFORMED', ''],
          ['FORMATS', 'USEFUL', ''],
          ['INFORMED', 'POLICY', ''],
          ['POLICY', 'OUTCOMES', '']
        ]
      },
      'toc-simple': {
        title: 'Theory of Change (Simplified)',
        nodes: {
          'A': 'Better Research Evaluation',
          'B': 'Focus on Impactful Research',
          'C': 'Paid Expert Evaluators',
          'D': 'Higher Quality Research',
          'E': 'Open Science Practices',
          'F': 'Academic Interest in Impact',
          'G': 'Decision Makers Better Informed',
          'H': 'Better Policy Choices',
          'I': 'Positive Global Outcomes'
        },
        classes: {
          'direct': ['B', 'D', 'E', 'G'],
          'multi': ['A', 'C', 'F', 'H', 'I']
        },
        edges: [
          ['A', 'D', ''], ['B', 'D', ''], ['B', 'E', ''], ['C', 'F', ''],
          ['D', 'G', ''], ['E', 'G', ''], ['F', 'G', ''],
          ['G', 'H', ''], ['H', 'I', '']
        ]
      },
      'workflow': {
        title: 'Evaluation Workflow',
        nodes: {
          'SUBMIT': 'Research Submitted or Identified',
          'PRIORITY': 'UJ Team Prioritizes',
          'DEPRI': 'Deprioritized',
          'CONTACT': 'Contact Authors for Permission',
          'MANAGER': 'Evaluation Manager Assigned',
          'RECRUIT': 'Evaluators Recruited: 2-3 accept',
          'REPORTS': 'Evaluators Complete Reports and Ratings',
          'RESPONSE': 'Authors Write Response',
          'SUMMARY': 'Manager Writes Summary',
          'PUBLISH': 'Published on PubPub with DOIs',
          'PROMOTE': 'Promoted and Tracked'
        },
        classes: {
          'start': ['SUBMIT'],
          'process': ['PRIORITY', 'CONTACT', 'PROMOTE'],
          'eval': ['MANAGER', 'RECRUIT', 'REPORTS', 'SUMMARY'],
          'author': ['RESPONSE'],
          'end_good': ['PUBLISH'],
          'end_bad': ['DEPRI']
        },
        edges: [
          ['SUBMIT', 'PRIORITY', ''],
          ['PRIORITY', 'DEPRI', 'Low priority'],
          ['PRIORITY', 'CONTACT', 'High priority'],
          ['CONTACT', 'DEPRI', 'Author declines'],
          ['CONTACT', 'MANAGER', 'Author agrees'],
          ['MANAGER', 'RECRUIT', ''],
          ['RECRUIT', 'REPORTS', '5+ weeks'],
          ['REPORTS', 'RESPONSE', '2 weeks'],
          ['RESPONSE', 'SUMMARY', ''],
          ['REPORTS', 'SUMMARY', ''],
          ['SUMMARY', 'PUBLISH', ''],
          ['RESPONSE', 'PUBLISH', ''],
          ['REPORTS', 'PUBLISH', ''],
          ['PUBLISH', 'PROMOTE', '']
        ]
      },
      'journal': {
        title: 'Traditional Journal Process',
        nodes: {
          'SUBMIT': 'Submit to Journal',
          'SCREEN': 'Desk Review',
          'DESK': 'Desk Rejected',
          'PASS': 'Passes to Reviewers',
          'FIND': 'Find Reviewers: 2-3 accept',
          'REVIEWS': 'Reviewers Return Reports',
          'DECISION': 'Editor Decision',
          'ACCEPT': 'Accepted',
          'REJECT': 'Rejected',
          'RR': 'Revise and Resubmit',
          'REVISE': 'Authors Revise',
          'DATA': 'Data Editor Review',
          'PUBLISHED': 'Published',
          'RETRY': 'Try Another Journal'
        },
        classes: {
          'bad': ['DESK', 'REJECT', 'RETRY'],
          'neutral': ['SUBMIT', 'PASS', 'FIND', 'REVIEWS', 'RR', 'REVISE', 'DATA'],
          'good': ['ACCEPT', 'PUBLISHED']
        },
        edges: [
          ['SUBMIT', 'SCREEN', '1-3 weeks'],
          ['SCREEN', 'DESK', ''],
          ['SCREEN', 'PASS', ''],
          ['PASS', 'FIND', '1-4 weeks'],
          ['FIND', 'REVIEWS', '1-6 months'],
          ['REVIEWS', 'DECISION', 'kept secret'],
          ['DECISION', 'ACCEPT', ''],
          ['DECISION', 'REJECT', ''],
          ['DECISION', 'RR', ''],
          ['RR', 'REVISE', '4-12 weeks'],
          ['REVISE', 'FIND', ''],
          ['ACCEPT', 'DATA', ''],
          ['DATA', 'PUBLISHED', '2-8 weeks'],
          ['DESK', 'RETRY', ''],
          ['REJECT', 'RETRY', ''],
          ['RETRY', 'SUBMIT', '']
        ],
        decisions: ['SCREEN', 'DECISION']
      },
      'prioritization': {
        title: 'Research Prioritization Framework',
        nodes: {
          'START': 'Research Suggested',
          'Q1': 'Globally Decision-Relevant?',
          'Q2': 'Prestigious or Already Influential?',
          'Q3': 'Supports Impactful Work?',
          'Q4': 'Strong Methodology?',
          'HIGH': 'HIGH PRIORITY: Definitely Evaluate',
          'HIGH2': 'HIGH PRIORITY: Policy Stream',
          'MEDIUM': 'MEDIUM: Consider If Capacity',
          'MEDIUM2': 'MEDIUM-HIGH: Promising Neglected Work',
          'LOW': 'LOW: Not In Scope'
        },
        classes: {
          'start': ['START'],
          'question': ['Q1', 'Q2', 'Q3', 'Q4'],
          'high': ['HIGH', 'HIGH2'],
          'medium': ['MEDIUM', 'MEDIUM2'],
          'low': ['LOW']
        },
        edges: [
          ['START', 'Q1', ''],
          ['Q1', 'Q2', 'Yes'],
          ['Q1', 'Q3', 'Not directly'],
          ['Q2', 'HIGH', 'Prestigious and Relevant'],
          ['Q2', 'HIGH2', 'Influential but not prestigious'],
          ['Q2', 'Q4', 'Neither yet'],
          ['Q3', 'MEDIUM', 'Yes: methods, tools'],
          ['Q3', 'LOW', 'No'],
          ['Q4', 'MEDIUM2', 'Rigorous and clear'],
          ['Q4', 'LOW', 'Weak or unclear']
        ],
        decisions: ['Q1', 'Q2', 'Q3', 'Q4']
      }
    };

    // Class definitions for each diagram type
    const classStyles = {
      'toc-full': `
        classDef direct fill:#fef3c7,stroke:#d97706,stroke-width:2px,color:#92400e
        classDef multi fill:#dcfce7,stroke:#16a34a,stroke-width:2px,color:#166534
        classDef integrate fill:#dbeafe,stroke:#2563eb,stroke-width:2px,color:#1e40af
        classDef systemic fill:#fce7f3,stroke:#db2777,stroke-width:2px,color:#9d174d`,
      'toc-simple': `
        classDef direct fill:#fef3c7,stroke:#d97706,stroke-width:2px
        classDef multi fill:#dcfce7,stroke:#16a34a,stroke-width:2px`,
      'workflow': `
        classDef start fill:#e0f2fe,stroke:#0284c7,stroke-width:2px
        classDef process fill:#fef3c7,stroke:#d97706,stroke-width:2px
        classDef eval fill:#dbeafe,stroke:#2563eb,stroke-width:2px
        classDef author fill:#fce7f3,stroke:#db2777,stroke-width:2px
        classDef end_good fill:#dcfce7,stroke:#16a34a,stroke-width:3px
        classDef end_bad fill:#fee2e2,stroke:#dc2626,stroke-width:2px`,
      'journal': `
        classDef bad fill:#fee2e2,stroke:#dc2626,stroke-width:2px
        classDef neutral fill:#f3f4f6,stroke:#6b7280,stroke-width:1px
        classDef good fill:#dcfce7,stroke:#16a34a,stroke-width:2px`,
      'prioritization': `
        classDef start fill:#e0f2fe,stroke:#0284c7,stroke-width:2px
        classDef question fill:#fef3c7,stroke:#d97706,stroke-width:2px
        classDef high fill:#dcfce7,stroke:#16a34a,stroke-width:3px
        classDef medium fill:#fde68a,stroke:#d97706,stroke-width:2px
        classDef low fill:#fee2e2,stroke:#dc2626,stroke-width:2px`
    };

    // Generate mermaid code from diagram data
    function generateMermaidCode(diagramId) {
      const data = diagramData[diagramId];
      const shape = currentSettings.shape;
      const decisions = data.decisions || [];

      let code = 'flowchart TD\n';
      code += classStyles[diagramId] + '\n\n';

      // Generate nodes with selected shape
      for (const [id, text] of Object.entries(data.nodes)) {
        if (decisions.includes(id)) {
          // Decision nodes always use diamond shape
          code += `    ${id}{"${text}"}\n`;
        } else if (shape === 'rectangle') {
          code += `    ${id}["${text}"]\n`;
        } else if (shape === 'rounded') {
          code += `    ${id}["${text}"]\n`;
        } else if (shape === 'stadium') {
          code += `    ${id}(["${text}"])\n`;
        } else if (shape === 'hexagon') {
          code += `    ${id}{{"${text}"}}\n`;
        } else if (shape === 'parallelogram') {
          code += `    ${id}[/"${text}"/]\n`;
        }
      }

      code += '\n';

      // Generate edges
      for (const [from, to, label] of data.edges) {
        if (label) {
          code += `    ${from} -->|${label}| ${to}\n`;
        } else {
          code += `    ${from} --> ${to}\n`;
        }
      }

      code += '\n';

      // Apply classes
      for (const [className, nodeIds] of Object.entries(data.classes)) {
        for (const nodeId of nodeIds) {
          code += `    class ${nodeId} ${className}\n`;
        }
      }

      return code;
    }

    // Change handlers
    function changeTheme(theme) {
      document.body.className = 'theme-' + theme;
    }

    function changeFontSize(size) {
      currentSettings.fontSize = parseInt(size);
    }

    function changeShape(shape) {
      currentSettings.shape = shape;
      // Add body class for CSS-based shape modifications
      document.body.classList.remove('shape-rectangle', 'shape-rounded', 'shape-stadium', 'shape-hexagon', 'shape-parallelogram');
      document.body.classList.add('shape-' + shape);
    }

    function changeCurve(curve) {
      currentSettings.curve = curve;
    }

    function changeAnimation(animation) {
      currentSettings.animation = animation;
    }

    // Apply animation to diagram
    function applyAnimation(container) {
      const svg = container.querySelector('svg');
      if (!svg) return;

      const nodes = svg.querySelectorAll('.node');
      const edges = svg.querySelectorAll('.edgePath');
      const labels = svg.querySelectorAll('.edgeLabel');

      const animation = currentSettings.animation;

      if (animation === 'none') {
        nodes.forEach(n => { n.style.opacity = 1; n.style.transform = 'none'; });
        edges.forEach(e => { e.style.opacity = 1; });
        labels.forEach(l => { l.style.opacity = 1; });
        return;
      }

      // Reset all elements
      nodes.forEach(n => { n.style.opacity = 0; n.style.transition = 'all 0.5s ease'; });
      edges.forEach(e => { e.style.opacity = 0; e.style.transition = 'all 0.5s ease'; });
      labels.forEach(l => { l.style.opacity = 0; l.style.transition = 'all 0.5s ease'; });

      if (animation === 'fade') {
        setTimeout(() => {
          nodes.forEach(n => { n.style.opacity = 1; });
          edges.forEach(e => { e.style.opacity = 1; });
          labels.forEach(l => { l.style.opacity = 1; });
        }, 100);
      } else if (animation === 'slide') {
        nodes.forEach(n => { n.style.transform = 'translateY(-20px)'; });
        setTimeout(() => {
          nodes.forEach(n => { n.style.opacity = 1; n.style.transform = 'translateY(0)'; });
          edges.forEach(e => { e.style.opacity = 1; });
          labels.forEach(l => { l.style.opacity = 1; });
        }, 100);
      } else if (animation === 'sequential') {
        nodes.forEach((n, i) => {
          setTimeout(() => {
            n.style.opacity = 1;
            n.style.transform = 'scale(1)';
          }, i * 150);
        });
        setTimeout(() => {
          edges.forEach((e, i) => {
            setTimeout(() => { e.style.opacity = 1; }, i * 50);
          });
          labels.forEach((l, i) => {
            setTimeout(() => { l.style.opacity = 1; }, i * 50);
          });
        }, nodes.length * 150);
      }
    }

    // Re-render all diagrams
    async function reRenderDiagrams() {
      initMermaid();

      const containers = document.querySelectorAll('.mermaid');
      const diagramIds = ['toc-full', 'toc-simple', 'workflow', 'journal', 'prioritization'];

      for (let i = 0; i < containers.length; i++) {
        const container = containers[i];
        const diagramId = diagramIds[i];

        if (diagramData[diagramId]) {
          const code = generateMermaidCode(diagramId);
          container.innerHTML = code;
          container.removeAttribute('data-processed');
        }
      }

      await mermaid.run();

      // Apply animations after render
      containers.forEach(container => {
        applyAnimation(container);
      });
    }

    // Initial render on page load
    document.addEventListener('DOMContentLoaded', async () => {
      initMermaid();
      await mermaid.run();

      // Apply initial animation if set
      document.querySelectorAll('.mermaid').forEach(container => {
        applyAnimation(container);
      });
    });
  </script>

</body>
</html>
