# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is The Unjournal's knowledge base, communications, and outreach repository. The Unjournal provides open, rigorous evaluation of quantitative research informing global priorities, especially in economics, policy, and social science.

The repository contains:
- **GitBook content**: Markdown files organized by topic (policies, benefits, FAQ, grants, etc.)
- **Landing pages** (`landing-pages/`): Static HTML pages hosted on `info.unjournal.org` (Linode), designed for Google Nonprofit Ad Grant campaigns
- **Interactive docs** (`docs/`): Mermaid diagram gallery, Reveal.js presentations, and interactive process diagrams
- **Forum bot** (`unjournal-forum-bot/`): CLI tool that searches EA Forum for posts about Unjournal-evaluated papers and posts comments linking to evaluations
- **Newsletter automation** (inactive): Mailchimp email digest system, not currently in use

## Forum Bot (unjournal-forum-bot/)

CLI tool that searches EA Forum (and eventually LessWrong) for posts referencing Unjournal-evaluated papers, and posts comments linking to the evaluations.

### Setup
- Python 3.11+, installed via `pip install -e ".[dev]"` in a venv
- Requires `config.toml` (copy from `config.example.toml`) with EA Forum auth token + Algolia keys
- See `scripts/capture_credentials.md` for how to get credentials from browser devtools

### Key commands
- `forum-bot run --dry-run` — scan papers, find matches, report what would be posted (default)
- `forum-bot run --no-dry-run` — actually post comments (requires confirmation)
- `forum-bot search "query"` — raw Algolia search for debugging
- `forum-bot list-papers` — show loaded papers from CSV
- `forum-bot introspect` — verify auth token and GraphQL schema

### Architecture
- **Algolia** for search (not GraphQL); **GraphQL** for fetching posts, comments, and posting
- Auth via `loginToken` cookie (~5 year lifetime)
- Type A matches (direct paper reference) can be auto-commented; Type B (related) are report-only
- Double dedup: checks existing post comments via API + local `~/.unjournal-forum-bot/state.json`
- LessWrong client is stubbed (`NotImplementedError`), pending bot account

### Data source
- CSV at `llm-uj-research-eval/data/paper_abstracts_meta_data/paper_abstracts_and_metadata.csv`
- Only papers with `doi_eval_summary` (PubPub DOI URL) get comments

## Newsletter System (Inactive)

> **Note:** This system is not actively used. The code remains in the repo for reference but the Mailchimp integration is not connected. The Unjournal's current newsletter goes out via Squarespace/other channels.

The newsletter automation was designed to trigger on pushes to `main` when the commit message contains `#PushNewsletter`.

### Architecture

- `main.py` - Entry point that orchestrates email sending
- `email_client/` - Mailchimp API wrapper (`EmailClient` class)
- `newsletter/` - Parses `UPDATES.md` content, converts GitBook markdown to HTML
- `UPDATES.md` - Content file used for newsletter body (auto-generated by GitHub Action from git diff)

## GitBook Content Structure

- `SUMMARY.md` - Table of contents defining navigation structure
- `README.md` - Landing page content
- Content organized in directories: `benefits-and-features/`, `policies-projects-evaluation-workflow/`, `faq-interaction/`, `readme-1/` (about/team info), etc.

### GitBook-Specific Markdown

GitBook uses custom syntax including:
- `{% hint style="info" %}...{% endhint %}` - Callout boxes
- `{% embed url="..." %}` - Embedded links
- `{% code overflow="wrap" %}` - Code block formatting
- YAML frontmatter for page layout configuration

## Landing Pages (info.unjournal.org)

Static HTML landing pages hosted on a Linode server (45.79.160.157) at `info.unjournal.org`. These exist because Squarespace (which hosts unjournal.org) has no content API, and Google Ad Grant campaigns need dedicated landing pages on a verified nonprofit domain.

### Pages
- `landing-pages/index.html` → `info.unjournal.org/` — General Unjournal overview
- `landing-pages/forecasting-tournament.html` → `info.unjournal.org/forecasting-tournament/` — Animal welfare forecasting tournament (with Metaculus)
- `landing-pages/follow.html` → `info.unjournal.org/follow/` — Social media, news, and engagement hub
- `landing-pages/donate.html` → `info.unjournal.org/donate/` — Donation/support page with interactive impact calculator (for Google Ad Grant campaigns)
- `landing-pages/update-news.py` — Script that fetches RSS from `unjournal.org/news?format=rss` and updates the follow page's news section (runs daily via cron on Linode at 6 AM UTC)
- `landing-pages/google-apps-script.js` — Reference only (unused); form backend uses Coda

### Deployment
Pages are deployed via `scp` to `/var/www/info.unjournal.org/` on the Linode server. Nginx serves them with Let's Encrypt HTTPS. DNS is an A record (`info` → `45.79.160.157`) in Squarespace's domain manager.

```bash
# Example deployment
scp landing-pages/forecasting-tournament.html root@45.79.160.157:/var/www/info.unjournal.org/forecasting-tournament/index.html
```

## Interactive Docs (docs/)

- `docs/gallery.html` — Mermaid diagram gallery with multiple diagram types and rendering options
- `docs/reveal-*.html` — Reveal.js step-through presentations (evaluation process, theory of change)
- `docs/interactive.html` — Interactive process diagram
- `docs/diagrams/` — SVG/image assets for diagrams

These are served directly via GitHub Pages or linked from GitBook content.

## Style Guide

The Unjournal maintains a style guide for documentation consistency: https://docs.google.com/document/d/10aooH_YCVX__pXFqnY1l8Kn2_DPX9wdHdR9AfImSuDs/edit

## Key URLs

- **Public GitBook**: `https://globalimpact.gitbook.io/the-unjournal-project-and-communication-space/`
- **PubPub evaluations**: `https://unjournal.pubpub.org/`
- **Shiny dashboard**: `https://unjournal.shinyapps.io/uj-dashboard/`
- **Main website**: `https://unjournal.org`
- **Ad Grant landing pages**: `https://info.unjournal.org`

Note: The old URL `effective-giving-marketing.gitbook.io` redirects to the current `globalimpact.gitbook.io` domain.

## Content Maintenance Notes

### Statistics (update periodically)
- As of January 2026: 100+ evaluations of 53 papers
- Source of truth: Shiny dashboard and internal Coda

### Archived content
Historical content (pilot phase 2022-2023, old job postings, etc.) is preserved in `<details>` collapsible sections rather than deleted, to maintain persistent links.

### Internal vs public links
- Never link to internal Coda pages in public GitBook content (except parenthetically for team reference)
- Use relative paths for internal GitBook links, not full URLs

### Prize programs
- 2023 pilot prize: Completed, winners announced
- 2024-25: Evaluator prizes ($6,500), recognition-based author awards (Flowing Water Scholar, Polaris Research)
- 2026+: Monetary author prizes planned, funding dependent

## January 2026 Cleanup Summary

Major cleanup performed including:
- Fixed corrupted character encoding (`&#xNAN;` patterns)
- Removed empty headers and duplicate orphan files
- Updated Impactful Research Prize page with current 2024-25 status
- Archived pilot phase content in collapsibles
- Fixed old GitBook URLs to internal paths
- Updated outdated date references
- Removed Kotahi references from active pages (now archived)
- Streamlined plan-of-action and funding sections
